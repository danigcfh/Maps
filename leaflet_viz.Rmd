---
title: "Facebook Posts by Country"
author: "DaniGCFH"
date: "2024-03-26"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(leaflet)
library(dplyr)
library(ggmap)
library(maps)
library(readr)

```

## Mapping Facebook Interactions

This work comes from a database I used for my master thesis as of March 26th 2024. It compiles varius interactions between Latin American Facebook groups. The following maps illustrate some of the information about these interactions. 

# Content creators

This first map shows the distribution of content creation in the region. The size of each circle represents the population while the color of each circle represents the amount of content generated by each country (the darker the color, the more content created). As we can see, there are relatively few content creators and they seem to be heavily concentrated in Mexico.

```{r cars, echo = FALSE,warning=FALSE,message=FALSE,error=FALSE}

# Load your data
df_origin <- readr::read_csv("df_origin.csv")
country_coords <- readr::read_csv("country-coord.csv")
WPP<- read_csv("WPP2022_Demographic_Indicators_Medium.csv")
WPP <- subset(WPP, WPP$Time == 2022)
WPP <- subset(WPP, !is.na(WPP$ISO3_code))
WPP1 <- subset(WPP, select = c(ISO2_code, TPopulation1Jan))


# Merge data and remove rows with missing weight values
merged_data <- left_join(country_coords, df_origin, by = c("Alpha-3 code" = "Country")) %>%
  filter(!is.na(Weight))
merged_data <- left_join(merged_data, WPP1, by = c("Alpha-2 code" = "ISO2_code")) %>%
  filter(!is.na(Weight))

```

```{r map}
# Create Leaflet map
leaflet(data = merged_data) %>%
  addTiles() %>%
  addCircleMarkers(
    lng = ~`Longitude (average)`,
    lat = ~`Latitude (average)`,
    radius = ~sqrt(TPopulation1Jan/100), # Adjust radius based on weight
    color = "black",
    fillColor = ~colorNumeric(palette = "Blues", domain = log(merged_data$Weight))(log(Weight)),
    stroke = TRUE,
    fillOpacity = 0.6,
    popup = ~paste("Country: ", Country, "<br>Weight: ", Weight)
  ) %>%
  addLegend(
    position = "bottomright",
    pal = colorNumeric(
      palette = "Blues", 
      domain = merged_data$Weight,
      na.color = "transparent"
    ),
    values = ~Weight,
    title = "Weight",
    opacity = 1
  )


```

# Content 

For this next map, I identified the mentions of other countries within the publication. So for example, if an ecuadorean content creator talked about brazil, then brazil was coded. Based on this work, I identified how much Latin American Facebook groups talk about each other. The following map presents how often each country was mentioned in the content analyzed, with the color of the circles representing the frequence and the size representing the country's population. This visualization shows that the content is more evenly distributed among the countries of the region, meaning that even when most content creators come from Mexico, the content itself often talks about the other countries in the region. 


```{r pressure, echo=FALSE, warning=FALSE,message=FALSE,error=FALSE}

# Load your data
df_target <- readr::read_csv("df_target.csv")

# Merge data and remove rows with missing weight values
merged_dataT <- left_join(country_coords, df_target, by = c("Alpha-3 code" = "Country")) %>%
  filter(!is.na(Weight))
merged_dataT <- left_join(merged_dataT, WPP1, by = c("Alpha-2 code" = "ISO2_code")) %>%
  filter(!is.na(Weight))
merged_dataT <- subset(merged_dataT, merged_dataT$Weight > 2)
```

```{r map2, echo=FALSE}

# Create Leaflet map
# Create Leaflet map
leaflet(data = merged_dataT) %>%
  addTiles() %>%
  addCircleMarkers(
    lng = ~`Longitude (average)`,
    lat = ~`Latitude (average)`,
    radius = ~sqrt(TPopulation1Jan/100), # Adjust radius based on weight
    color = "black",
    fillColor = ~colorNumeric(palette = "Blues", domain = log(merged_dataT$Weight))(log(Weight)),
    stroke = TRUE,
    fillOpacity = 0.6,
    popup = ~paste("Country: ", Country, "<br>Weight: ", Weight)
  ) %>%
  addLegend(
    position = "bottomright",
    pal = colorNumeric(
      palette = "Blues", 
      domain = merged_dataT$Weight,
      na.color = "transparent"
    ),
    values = ~Weight,
    title = "Weight",
    opacity = 1
  )

```
